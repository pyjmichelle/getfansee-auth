---
description: CORE KERNEL - Absolute law for Planning, Testing, and Standards.
globs: *
alwaysApply: true
---
# PROJECT ZERO KERNEL (v4.0)

## 1. STOP and READ (Planning)
Before writing ONE line of code:
- Check `docs/planning/sprint-4.0-mvp.md`
- If the task is not planned, refuse until planned
- Code to FULFILL the plan, not to improvise

## 2. VERIFY OR DIE (Testing)
- "I have fixed it" is NOT acceptable
- "Here is the passing test log" IS acceptable
- Logic changes -> Run `pnpm exec playwright test tests/e2e/smoke.spec.ts`
- UI changes -> Run diagnostic script for console errors
- ALWAYS provide test output as proof

## 3. CLEAN CODE (Standards)
- No console.log clutter (use proper logger)
- No `any` types in TypeScript
- shadcn UI: Use `cn()` and components from `@/components/ui`
- Follow `.cursor/skills/shadcn-ui.skill.md` for UI patterns

## 4. NO HALLUCINATIONS
- Unsure about Supabase/Stripe API? -> SEARCH DOCS using Browser Tool
- Never guess API responses or database schemas
- Verify before implementing

## 5. AGENT DISPATCH
When to use specific agents:
- UI/UX issues -> `chief-frontend-architect`
- API/Database issues -> `chief-backend-platform`
- Testing issues -> `chief-quality-officer`
- Security concerns -> `chief-security-architect`
- Payment/Billing -> `chief-payments-risk`

## 6. FILE ORGANIZATION
- Tests go in `tests/` directory (unit, integration, e2e)
- Legacy reports go in `docs/archive/legacy_reports/`
- Deployment docs go in `docs/deployment/`
- Planning docs go in `docs/planning/`

## 7. CI/CD & CODE QUALITY GATES (MANDATORY) ğŸš€
**CRITICAL**: æ¯æ¬¡æ¨é€åˆ° CI å‰å¿…é¡»é€šè¿‡æ‰€æœ‰æ£€æŸ¥!

### Pre-Push æ£€æŸ¥ (å¿…é¡»é€šè¿‡)
```bash
pnpm check-all  # ä¸€é”®è¿è¡Œæ‰€æœ‰æ£€æŸ¥
```

åŒ…å«ä»¥ä¸‹æ£€æŸ¥:
1. âœ… `pnpm type-check` - TypeScript ç±»å‹æ£€æŸ¥ (0 errors)
2. âœ… `pnpm lint` - ESLint ä»£ç è§„èŒƒ (0 errors, warnings å¯æ¥å—)
3. âœ… `pnpm format:check` - Prettier æ ¼å¼æ£€æŸ¥
4. âœ… `pnpm test:unit` - å•å…ƒæµ‹è¯• (all pass)
5. âœ… `pnpm build` - æ„å»ºéªŒè¯ (must succeed)

### Git Hook è‡ªåŠ¨ä¿æŠ¤
- **Pre-commit**: `lint-staged` æ£€æŸ¥æš‚å­˜åŒºæ–‡ä»¶
- **Pre-push**: è‡ªåŠ¨è¿è¡Œ `pnpm check-all`
- â›” æ£€æŸ¥å¤±è´¥ä¼šé˜»æ­¢æ¨é€

### ç¦æ­¢è¡Œä¸º âŒ
- âŒ ç¦æ­¢æ¨é€æœªé€šè¿‡æœ¬åœ°æ£€æŸ¥çš„ä»£ç 
- âŒ ç¦æ­¢ä½¿ç”¨ `git push --no-verify` è·³è¿‡æ£€æŸ¥
- âŒ ç¦æ­¢åœ¨ PR æœªé€šè¿‡ CI æ—¶åˆå¹¶

### æ ‡å‡†å·¥ä½œæµç¨‹
1. å¼€å‘å®Œæˆ â†’ è¿è¡Œ `pnpm check-all`
2. ä¿®å¤æ‰€æœ‰é—®é¢˜ â†’ å†æ¬¡è¿è¡Œç¡®è®¤é€šè¿‡
3. `git add .` â†’ `git commit -m "feat: æè¿°"`
4. `git push` (è‡ªåŠ¨è§¦å‘ pre-push hook)
5. åˆ›å»º PR â†’ ç­‰å¾… CI é€šè¿‡ (3 ä¸ªå·¥ä½œæµ)
6. æ‰€æœ‰æ£€æŸ¥ âœ… â†’ åˆå¹¶ PR

### CI å·¥ä½œæµ
- `ci.yml`: ä¸»æµæ°´çº¿ (Lint â†’ Build â†’ QA â†’ E2E)
- `code-quality.yml`: Reviewdog è‡ªåŠ¨è¯„è®º
- `pr-auto-review.yml`: æ ‡ç­¾ + å®‰å…¨æ‰«æ

### æ–‡æ¡£
- `.github/PRE_COMMIT_CHECKLIST.md` - æ£€æŸ¥æ¸…å•
- `.github/GITHUB_SECRETS_SETUP.md` - GitHub Secrets é…ç½®
- `CI_REVIEW_SETUP.md` - CI ç³»ç»Ÿé…ç½®
- `SETUP_COMPLETE.md` - å®Œæ•´é…ç½®æŒ‡å—
