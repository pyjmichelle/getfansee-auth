---
description: CORE KERNEL - Absolute law for Planning, Testing, and Standards.
globs: *
alwaysApply: true
---
# PROJECT ZERO KERNEL (v4.2)

This kernel defines the **non-negotiable operating law** for GetFanSee.
Its purpose is to prevent hallucination, partial delivery, fake completion,
and workflow deadlocks.

---

## 0. ABSOLUTE PRINCIPLE
- The goal is **green gates**, not storytelling.
- Anything that does not end with passing commands is **NOT DONE**.
- Process exists to unblock delivery, not to block it.

---

## 1. STOP and READ (Planning)

Before writing ONE line of code:

### 1.1 Planning File Rule
- Check `docs/planning/sprint-current.md`.
- If it does NOT exist:
  - You MUST create it as the **first change** (minimal stub is acceptable).

### 1.2 Task Admission Rule
- If the task is not listed:
  - Add it to `sprint-current.md` with:
    - Priority (P0 / P1 / P2)
    - Scope
    - Acceptance Criteria
    - Required Gate Commands

### 1.3 Explicit Exception (NO BLOCKING ALLOWED)
The following **DO NOT require prior planning** and MUST be fixed immediately:

- CI / CD failures
- `pnpm check-all` failures
- Lint / type-check / build breakages
- Playwright / webServer / test infra failures
- Environment / dependency / font / network related test failures

**Rule**:
> Fix with minimal diff first â†’ then backfill planning entry.

Using â€œmissing planning fileâ€ as a reason to refuse fixing gates is **FORBIDDEN**.

---

## 2. VERIFY OR DIE (Testing)

### 2.1 Proof Standard
- âŒ â€œI fixed itâ€ â†’ INVALID
- âœ… â€œHere is the passing logâ€ â†’ REQUIRED

### 2.2 Mandatory Gate Sequence (Default)
Unless explicitly scoped otherwise, delivery MUST include:

```bash
pnpm check-all
pnpm build
pnpm qa:gate
pnpm exec playwright test --project=chromium
```

All outputs must PASS.

2.3 Scoped Testing Rules

Logic changes â†’ run:

```bash
pnpm exec playwright test tests/e2e/smoke.spec.ts
```

UI changes â†’ run:

Console error diagnostics

At least one relevant e2e route test

Infra / config changes â†’ re-run the failed gate until green

Partial gate success â‰  completion.

3. CLEAN CODE (Standards)

Non-negotiable:

No console.log noise (use logger or remove)

No any types (use explicit types or unknown + narrowing)

TypeScript strict mode respected

shadcn/ui:

Use cn()

Use components from @/components/ui

Follow .cursor/skills/shadcn-ui.skill.md

4. NO HALLUCINATIONS

Unsure about Supabase / Stripe / Next.js / Playwright behavior?
â†’ SEARCH OFFICIAL DOCS.

Never guess:

API responses

DB schema

Auth/session behavior

If not 100% sure, say â€œUNKNOWN â€“ NEED VERIFICATIONâ€.

5. AGENT DISPATCH (MANDATORY)

Route problems correctly:

UI / hydration / layout â†’ chief-frontend-architect

API / DB / Supabase â†’ chief-backend-platform

Tests / CI / Playwright â†’ chief-quality-officer

Security / auth / permissions â†’ chief-security-architect

Payments / billing â†’ chief-payments-risk

Wrong agent = invalid solution.

6. FILE ORGANIZATION LAW

Tests â†’ tests/

Planning â†’ docs/planning/

Deployment â†’ docs/deployment/

Legacy / reports â†’ docs/archive/legacy_reports/

No random placement.

7. CI/CD & QUALITY GATES (ABSOLUTE)
7.1 Local Gate (Pre-push)

Must pass:

```bash
pnpm check-all
```

Includes (as configured in repo):

type-check

lint (respect max-warnings threshold)

format check

unit tests

build

Repo config is the source of truth.
Do NOT assume warnings are acceptable.

7.2 Forbidden Actions âŒ

âŒ Pushing with failing gates

âŒ git push --no-verify

âŒ Merging PRs with red CI

âŒ Silencing failures by weakening gates

7.3 Evidence Rule

Every â€œdoneâ€ must include:

Commands run

Final PASS output (log or artifact path)

No exceptions.

8. DEFINITION OF DONE (DoD)

A task is DONE only if:

All scoped gates are green

No regressions introduced

Logs or artifacts are provided

Planning file reflects the change (or was backfilled)

Anything else = NOT DONE.


---

# ğŸ“„ é…å¥—å¿…éœ€æ–‡ä»¶ï¼ˆå¿…é¡»ä¸€èµ·å­˜åœ¨ï¼‰

## `docs/planning/sprint-current.md`ï¼ˆæœ€å°ä½†å®Œæ•´ï¼‰

```md
# Sprint Plan â€“ Current

## Sprint Goal
- Maintain green CI/CD gates
- Stabilize auth, build, and Playwright pipeline

## Active Tasks

### P0 â€“ Fix Playwright chromium gate (next/font Google fetch)
- Scope:
  - Playwright webServer / test config only
  - No product or runtime behavior changes
- Acceptance Criteria:
  - `pnpm exec playwright test --project=chromium` passes in CI/offline
- Required Gates:
  - pnpm check-all
  - pnpm build
  - pnpm qa:gate
  - pnpm exec playwright test --project=chromium

---

### P1 â€“ Kernel & Planning normalization
- Scope:
  - Replace hard-coded sprint file dependency
  - Enforce unblock-first planning rule
- Acceptance Criteria:
  - No task blocked by missing planning file
```
