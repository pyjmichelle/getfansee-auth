{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/puyijun/Downloads/authentication-flow-design%20%281%29/components/ui/button.tsx"],"sourcesContent":["import * as React from 'react'\nimport { Slot } from '@radix-ui/react-slot'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from '@/lib/utils'\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n  {\n    variants: {\n      variant: {\n        default: 'bg-primary text-primary-foreground hover:bg-primary/90',\n        destructive:\n          'bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',\n        outline:\n          'border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50',\n        secondary:\n          'bg-secondary text-secondary-foreground hover:bg-secondary/80',\n        ghost:\n          'hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50',\n        link: 'text-primary underline-offset-4 hover:underline',\n      },\n      size: {\n        default: 'h-9 px-4 py-2 has-[>svg]:px-3',\n        sm: 'h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5',\n        lg: 'h-10 rounded-md px-6 has-[>svg]:px-4',\n        icon: 'size-9',\n        'icon-sm': 'size-8',\n        'icon-lg': 'size-10',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default',\n    },\n  },\n)\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<'button'> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot : 'button'\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,iBAAiB,IAAA,+SAAG,EACxB,+bACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;YACN,WAAW;YACX,WAAW;QACb;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,EACd,SAAS,EACT,OAAO,EACP,IAAI,EACJ,UAAU,KAAK,EACf,GAAG,OAIF;IACD,MAAM,OAAO,UAAU,yWAAI,GAAG;IAE9B,qBACE,8ZAAC;QACC,aAAU;QACV,WAAW,IAAA,+KAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf;KAnBS"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///Users/puyijun/Downloads/authentication-flow-design%20%281%29/components/ui/sheet.tsx"],"sourcesContent":["'use client'\n\nimport * as React from 'react'\nimport * as SheetPrimitive from '@radix-ui/react-dialog'\nimport { XIcon } from 'lucide-react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {\n  return <SheetPrimitive.Root data-slot=\"sheet\" {...props} />\n}\n\nfunction SheetTrigger({\n  ...props\n}: React.ComponentProps<typeof SheetPrimitive.Trigger>) {\n  return <SheetPrimitive.Trigger data-slot=\"sheet-trigger\" {...props} />\n}\n\nfunction SheetClose({\n  ...props\n}: React.ComponentProps<typeof SheetPrimitive.Close>) {\n  return <SheetPrimitive.Close data-slot=\"sheet-close\" {...props} />\n}\n\nfunction SheetPortal({\n  ...props\n}: React.ComponentProps<typeof SheetPrimitive.Portal>) {\n  return <SheetPrimitive.Portal data-slot=\"sheet-portal\" {...props} />\n}\n\nfunction SheetOverlay({\n  className,\n  ...props\n}: React.ComponentProps<typeof SheetPrimitive.Overlay>) {\n  return (\n    <SheetPrimitive.Overlay\n      data-slot=\"sheet-overlay\"\n      className={cn(\n        'data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SheetContent({\n  className,\n  children,\n  side = 'right',\n  ...props\n}: React.ComponentProps<typeof SheetPrimitive.Content> & {\n  side?: 'top' | 'right' | 'bottom' | 'left'\n}) {\n  return (\n    <SheetPortal>\n      <SheetOverlay />\n      <SheetPrimitive.Content\n        data-slot=\"sheet-content\"\n        className={cn(\n          'bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500',\n          side === 'right' &&\n            'data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm',\n          side === 'left' &&\n            'data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm',\n          side === 'top' &&\n            'data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b',\n          side === 'bottom' &&\n            'data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t',\n          className,\n        )}\n        {...props}\n      >\n        {children}\n        <SheetPrimitive.Close className=\"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none\">\n          <XIcon className=\"size-4\" />\n          <span className=\"sr-only\">Close</span>\n        </SheetPrimitive.Close>\n      </SheetPrimitive.Content>\n    </SheetPortal>\n  )\n}\n\nfunction SheetHeader({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"sheet-header\"\n      className={cn('flex flex-col gap-1.5 p-4', className)}\n      {...props}\n    />\n  )\n}\n\nfunction SheetFooter({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"sheet-footer\"\n      className={cn('mt-auto flex flex-col gap-2 p-4', className)}\n      {...props}\n    />\n  )\n}\n\nfunction SheetTitle({\n  className,\n  ...props\n}: React.ComponentProps<typeof SheetPrimitive.Title>) {\n  return (\n    <SheetPrimitive.Title\n      data-slot=\"sheet-title\"\n      className={cn('text-foreground font-semibold', className)}\n      {...props}\n    />\n  )\n}\n\nfunction SheetDescription({\n  className,\n  ...props\n}: React.ComponentProps<typeof SheetPrimitive.Description>) {\n  return (\n    <SheetPrimitive.Description\n      data-slot=\"sheet-description\"\n      className={cn('text-muted-foreground text-sm', className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sheet,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAGA;AACA;AAEA;AANA;;;;;AAQA,SAAS,MAAM,EAAE,GAAG,OAAyD;IAC3E,qBAAO,8ZAAC,2bAAmB;QAAC,aAAU;QAAS,GAAG,KAAK;;;;;;AACzD;KAFS;AAIT,SAAS,aAAa,EACpB,GAAG,OACiD;IACpD,qBAAO,8ZAAC,8bAAsB;QAAC,aAAU;QAAiB,GAAG,KAAK;;;;;;AACpE;MAJS;AAMT,SAAS,WAAW,EAClB,GAAG,OAC+C;IAClD,qBAAO,8ZAAC,4bAAoB;QAAC,aAAU;QAAe,GAAG,KAAK;;;;;;AAChE;MAJS;AAMT,SAAS,YAAY,EACnB,GAAG,OACgD;IACnD,qBAAO,8ZAAC,6bAAqB;QAAC,aAAU;QAAgB,GAAG,KAAK;;;;;;AAClE;MAJS;AAMT,SAAS,aAAa,EACpB,SAAS,EACT,GAAG,OACiD;IACpD,qBACE,8ZAAC,8bAAsB;QACrB,aAAU;QACV,WAAW,IAAA,+KAAE,EACX,0JACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS;AAgBT,SAAS,aAAa,EACpB,SAAS,EACT,QAAQ,EACR,OAAO,OAAO,EACd,GAAG,OAGJ;IACC,qBACE,8ZAAC;;0BACC,8ZAAC;;;;;0BACD,8ZAAC,8bAAsB;gBACrB,aAAU;gBACV,WAAW,IAAA,+KAAE,EACX,8MACA,SAAS,WACP,oIACF,SAAS,UACP,iIACF,SAAS,SACP,4GACF,SAAS,YACP,qHACF;gBAED,GAAG,KAAK;;oBAER;kCACD,8ZAAC,4bAAoB;wBAAC,WAAU;;0CAC9B,8ZAAC,0VAAK;gCAAC,WAAU;;;;;;0CACjB,8ZAAC;gCAAK,WAAU;0CAAU;;;;;;;;;;;;;;;;;;;;;;;;AAKpC;MAnCS;AAqCT,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,8ZAAC;QACC,aAAU;QACV,WAAW,IAAA,+KAAE,EAAC,6BAA6B;QAC1C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,8ZAAC;QACC,aAAU;QACV,WAAW,IAAA,+KAAE,EAAC,mCAAmC;QAChD,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAClB,SAAS,EACT,GAAG,OAC+C;IAClD,qBACE,8ZAAC,4bAAoB;QACnB,aAAU;QACV,WAAW,IAAA,+KAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,iBAAiB,EACxB,SAAS,EACT,GAAG,OACqD;IACxD,qBACE,8ZAAC,kcAA0B;QACzB,aAAU;QACV,WAAW,IAAA,+KAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MAXS"}},
    {"offset": {"line": 271, "column": 0}, "map": {"version":3,"sources":["file:///Users/puyijun/Downloads/authentication-flow-design%20%281%29/components/ui/avatar.tsx"],"sourcesContent":["'use client'\n\nimport * as React from 'react'\nimport * as AvatarPrimitive from '@radix-ui/react-avatar'\n\nimport { cn } from '@/lib/utils'\n\nfunction Avatar({\n  className,\n  ...props\n}: React.ComponentProps<typeof AvatarPrimitive.Root>) {\n  return (\n    <AvatarPrimitive.Root\n      data-slot=\"avatar\"\n      className={cn(\n        'relative flex size-8 shrink-0 overflow-hidden rounded-full',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction AvatarImage({\n  className,\n  ...props\n}: React.ComponentProps<typeof AvatarPrimitive.Image>) {\n  return (\n    <AvatarPrimitive.Image\n      data-slot=\"avatar-image\"\n      className={cn('aspect-square size-full', className)}\n      {...props}\n    />\n  )\n}\n\nfunction AvatarFallback({\n  className,\n  ...props\n}: React.ComponentProps<typeof AvatarPrimitive.Fallback>) {\n  return (\n    <AvatarPrimitive.Fallback\n      data-slot=\"avatar-fallback\"\n      className={cn(\n        'bg-muted flex size-full items-center justify-center rounded-full',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Avatar, AvatarImage, AvatarFallback }\n"],"names":[],"mappings":";;;;;;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,OAAO,EACd,SAAS,EACT,GAAG,OAC+C;IAClD,qBACE,8ZAAC,2bAAoB;QACnB,aAAU;QACV,WAAW,IAAA,+KAAE,EACX,8DACA;QAED,GAAG,KAAK;;;;;;AAGf;KAdS;AAgBT,SAAS,YAAY,EACnB,SAAS,EACT,GAAG,OACgD;IACnD,qBACE,8ZAAC,4bAAqB;QACpB,aAAU;QACV,WAAW,IAAA,+KAAE,EAAC,2BAA2B;QACxC,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,eAAe,EACtB,SAAS,EACT,GAAG,OACmD;IACtD,qBACE,8ZAAC,+bAAwB;QACvB,aAAU;QACV,WAAW,IAAA,+KAAE,EACX,oEACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS"}},
    {"offset": {"line": 334, "column": 0}, "map": {"version":3,"sources":["file:///Users/puyijun/Downloads/authentication-flow-design%20%281%29/components/ui/badge.tsx"],"sourcesContent":["import * as React from 'react'\nimport { Slot } from '@radix-ui/react-slot'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from '@/lib/utils'\n\nconst badgeVariants = cva(\n  'inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden',\n  {\n    variants: {\n      variant: {\n        default:\n          'border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90',\n        secondary:\n          'border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90',\n        destructive:\n          'border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',\n        outline:\n          'text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n    },\n  },\n)\n\nfunction Badge({\n  className,\n  variant,\n  asChild = false,\n  ...props\n}: React.ComponentProps<'span'> &\n  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : 'span'\n\n  return (\n    <Comp\n      data-slot=\"badge\"\n      className={cn(badgeVariants({ variant }), className)}\n      {...props}\n    />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,gBAAgB,IAAA,+SAAG,EACvB,kZACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,SAAS,MAAM,EACb,SAAS,EACT,OAAO,EACP,UAAU,KAAK,EACf,GAAG,OAEuD;IAC1D,MAAM,OAAO,UAAU,yWAAI,GAAG;IAE9B,qBACE,8ZAAC;QACC,aAAU;QACV,WAAW,IAAA,+KAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf;KAhBS"}},
    {"offset": {"line": 386, "column": 0}, "map": {"version":3,"sources":["file:///Users/puyijun/Downloads/authentication-flow-design%20%281%29/components/ui/separator.tsx"],"sourcesContent":["'use client'\n\nimport * as React from 'react'\nimport * as SeparatorPrimitive from '@radix-ui/react-separator'\n\nimport { cn } from '@/lib/utils'\n\nfunction Separator({\n  className,\n  orientation = 'horizontal',\n  decorative = true,\n  ...props\n}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {\n  return (\n    <SeparatorPrimitive.Root\n      data-slot=\"separator\"\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        'bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Separator }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,UAAU,EACjB,SAAS,EACT,cAAc,YAAY,EAC1B,aAAa,IAAI,EACjB,GAAG,OACkD;IACrD,qBACE,8ZAAC,2bAAuB;QACtB,aAAU;QACV,YAAY;QACZ,aAAa;QACb,WAAW,IAAA,+KAAE,EACX,kKACA;QAED,GAAG,KAAK;;;;;;AAGf;KAlBS"}},
    {"offset": {"line": 421, "column": 0}, "map": {"version":3,"sources":["file:///Users/puyijun/Downloads/authentication-flow-design%20%281%29/components/nav-header.tsx"],"sourcesContent":["\"use client\"\n\nimport Link from \"next/link\"\nimport { usePathname } from \"next/navigation\"\nimport {\n  Bell,\n  Search,\n  Menu,\n  Home,\n  Heart,\n  CreditCard,\n  User,\n  LayoutDashboard,\n  FileText,\n  DollarSign,\n  Eye,\n  Sparkles,\n} from \"lucide-react\"\nimport { Button } from \"@/components/ui/button\"\nimport { Sheet, SheetContent, SheetTrigger } from \"@/components/ui/sheet\"\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { useState } from \"react\"\n\ninterface NavHeaderProps {\n  user?: {\n    username: string\n    role: \"fan\" | \"creator\"\n    avatar?: string\n    creatorStatus?: \"pending\" | \"approved\"\n  }\n  notificationCount?: number\n}\n\nexport function NavHeader({ user, notificationCount = 0 }: NavHeaderProps) {\n  const pathname = usePathname()\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false)\n  const [searchOpen, setSearchOpen] = useState(false)\n  const [searchQuery, setSearchQuery] = useState(\"\")\n\n  const isCreator = user?.role === \"creator\"\n  const showBecomeCreator = user && !isCreator\n\n  const [currentView, setCurrentView] = useState<\"fan\" | \"creator\">(user?.role || \"fan\")\n\n  const handleRoleSwitch = () => {\n    setCurrentView(currentView === \"fan\" ? \"creator\" : \"fan\")\n  }\n\n  return (\n    <header className=\"sticky top-0 z-50 w-full border-b border-border bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60\">\n      <div className=\"container flex h-16 items-center justify-between px-4\">\n        <div className=\"flex items-center gap-6\">\n          <Link href=\"/home\" className=\"flex items-center gap-2\">\n            <div className=\"w-8 h-8 rounded-lg bg-primary flex items-center justify-center\">\n              <span className=\"text-primary-foreground font-bold text-lg\">G</span>\n            </div>\n            <span className=\"font-bold text-xl hidden md:inline\">GetFanSee</span>\n          </Link>\n        </div>\n\n        <div className=\"hidden md:flex flex-1 max-w-md mx-6\">\n          {!searchOpen ? (\n            <Button\n              variant=\"outline\"\n              className=\"w-full justify-start text-muted-foreground bg-background\"\n              onClick={() => setSearchOpen(true)}\n            >\n              <Search className=\"w-4 h-4 mr-2\" />\n              Search creators...\n            </Button>\n          ) : (\n            <div className=\"relative w-full\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n              <input\n                type=\"text\"\n                placeholder=\"Search creators...\"\n                className=\"w-full h-10 pl-9 pr-4 rounded-md border border-border bg-background focus:outline-none focus:ring-2 focus:ring-primary\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                onBlur={() => {\n                  if (!searchQuery) setSearchOpen(false)\n                }}\n                autoFocus\n              />\n              {searchQuery && (\n                <div className=\"absolute top-full left-0 right-0 mt-2 bg-card border border-border rounded-md shadow-lg p-4\">\n                  <p className=\"text-sm text-muted-foreground\">No results found for \"{searchQuery}\"</p>\n                  <p className=\"text-xs text-muted-foreground mt-2\">Try searching for creator usernames</p>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex items-center gap-3\">\n          {showBecomeCreator && (\n            <Button asChild className=\"hidden md:flex bg-accent hover:bg-accent/90 text-accent-foreground\">\n              <Link href=\"/creator/upgrade\">\n                <Sparkles className=\"w-4 h-4 mr-2\" />\n                Become a Creator\n              </Link>\n            </Button>\n          )}\n\n          {user && (\n            <>\n              <Button variant=\"ghost\" size=\"icon\" className=\"relative\" asChild>\n                <Link href=\"/notifications\">\n                  <Bell className=\"w-5 h-5\" />\n                  {notificationCount > 0 && (\n                    <Badge className=\"absolute -top-1 -right-1 w-5 h-5 flex items-center justify-center p-0 text-xs\">\n                      {notificationCount}\n                    </Badge>\n                  )}\n                </Link>\n              </Button>\n\n              <Sheet open={mobileMenuOpen} onOpenChange={setMobileMenuOpen}>\n                <SheetTrigger asChild>\n                  <Button variant=\"ghost\" size=\"icon\">\n                    <Menu className=\"w-5 h-5\" />\n                  </Button>\n                </SheetTrigger>\n                <SheetContent side=\"left\" className=\"w-80\">\n                  <div className=\"mb-6 pt-4\">\n                    <div className=\"flex items-center gap-3 mb-4\">\n                      <Avatar className=\"w-12 h-12\">\n                        <AvatarImage src={user.avatar || \"/placeholder.svg\"} />\n                        <AvatarFallback>{user.username[0].toUpperCase()}</AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1\">\n                        <p className=\"font-semibold text-foreground\">{user.username}</p>\n                        <div className=\"flex items-center gap-2 mt-1\">\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            {isCreator ? \"Creator\" : \"Fan\"}\n                          </Badge>\n                          {isCreator && user.creatorStatus === \"pending\" && (\n                            <Badge variant=\"secondary\" className=\"text-xs bg-yellow-500/10 text-yellow-500\">\n                              Pending\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n\n                    {isCreator && (\n                      <>\n                        <div className=\"flex items-center gap-2 mb-4\">\n                          <Button\n                            variant={currentView === \"fan\" ? \"default\" : \"outline\"}\n                            size=\"sm\"\n                            onClick={() => setCurrentView(\"fan\")}\n                            className={currentView === \"fan\" ? \"\" : \"bg-transparent flex-1\"}\n                          >\n                            Fan\n                          </Button>\n                          <Button\n                            variant={currentView === \"creator\" ? \"default\" : \"outline\"}\n                            size=\"sm\"\n                            onClick={() => setCurrentView(\"creator\")}\n                            className={currentView === \"creator\" ? \"\" : \"bg-transparent flex-1\"}\n                          >\n                            Creator\n                          </Button>\n                        </div>\n                        <Separator className=\"mb-4\" />\n                      </>\n                    )}\n                  </div>\n\n                  <nav className=\"flex flex-col gap-2\">\n                    {(!isCreator || currentView === \"fan\") && (\n                      <>\n                        <p className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-2\">\n                          Discover\n                        </p>\n                        <Button\n                          variant={pathname === \"/home\" ? \"secondary\" : \"ghost\"}\n                          className=\"justify-start\"\n                          asChild\n                          onClick={() => setMobileMenuOpen(false)}\n                        >\n                          <Link href=\"/home\">\n                            <Home className=\"w-4 h-4 mr-3\" />\n                            Feed\n                          </Link>\n                        </Button>\n                        <Separator className=\"my-2\" />\n\n                        <p className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-2\">\n                          Your Content\n                        </p>\n                        <Button\n                          variant={pathname === \"/subscriptions\" ? \"secondary\" : \"ghost\"}\n                          className=\"justify-start\"\n                          asChild\n                          onClick={() => setMobileMenuOpen(false)}\n                        >\n                          <Link href=\"/subscriptions\">\n                            <Heart className=\"w-4 h-4 mr-3\" />\n                            Subscriptions\n                          </Link>\n                        </Button>\n                        <Button\n                          variant={pathname === \"/purchases\" ? \"secondary\" : \"ghost\"}\n                          className=\"justify-start\"\n                          asChild\n                          onClick={() => setMobileMenuOpen(false)}\n                        >\n                          <Link href=\"/purchases\">\n                            <CreditCard className=\"w-4 h-4 mr-3\" />\n                            Purchases\n                          </Link>\n                        </Button>\n                        <Separator className=\"my-2\" />\n                      </>\n                    )}\n\n                    {isCreator && currentView === \"creator\" && (\n                      <>\n                        <p className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-2\">\n                          Creator Studio\n                        </p>\n                        <Button\n                          variant={pathname === \"/creator/studio\" ? \"secondary\" : \"ghost\"}\n                          className=\"justify-start\"\n                          asChild\n                          onClick={() => setMobileMenuOpen(false)}\n                        >\n                          <Link href=\"/creator/studio\">\n                            <LayoutDashboard className=\"w-4 h-4 mr-3\" />\n                            Dashboard\n                          </Link>\n                        </Button>\n                        <Button\n                          variant={pathname?.startsWith(\"/creator/studio/post\") ? \"secondary\" : \"ghost\"}\n                          className=\"justify-start\"\n                          asChild\n                          onClick={() => setMobileMenuOpen(false)}\n                        >\n                          <Link href=\"/creator/studio/post/new\">\n                            <FileText className=\"w-4 h-4 mr-3\" />\n                            My Posts\n                          </Link>\n                        </Button>\n                        <Button\n                          variant={pathname === \"/creator/studio/earnings\" ? \"secondary\" : \"ghost\"}\n                          className=\"justify-start\"\n                          asChild\n                          onClick={() => setMobileMenuOpen(false)}\n                        >\n                          <Link href=\"/creator/studio/earnings\">\n                            <DollarSign className=\"w-4 h-4 mr-3\" />\n                            Earnings\n                          </Link>\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          className=\"justify-start\"\n                          asChild\n                          onClick={() => setMobileMenuOpen(false)}\n                        >\n                          <Link href={`/creator/${user.username}?viewAs=fan`}>\n                            <Eye className=\"w-4 h-4 mr-3\" />\n                            View as Fan\n                          </Link>\n                        </Button>\n                        <Separator className=\"my-2\" />\n                      </>\n                    )}\n\n                    <p className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-2\">Account</p>\n                    <Button\n                      variant={pathname === \"/me\" ? \"secondary\" : \"ghost\"}\n                      className=\"justify-start\"\n                      asChild\n                      onClick={() => setMobileMenuOpen(false)}\n                    >\n                      <Link href=\"/me\">\n                        <User className=\"w-4 h-4 mr-3\" />\n                        Profile\n                      </Link>\n                    </Button>\n\n                    {showBecomeCreator && (\n                      <>\n                        <Separator className=\"my-2\" />\n                        <Button\n                          variant=\"default\"\n                          className=\"justify-start bg-accent hover:bg-accent/90 text-accent-foreground\"\n                          asChild\n                          onClick={() => setMobileMenuOpen(false)}\n                        >\n                          <Link href=\"/creator/upgrade\">\n                            <Sparkles className=\"w-4 h-4 mr-3\" />\n                            Become a Creator\n                          </Link>\n                        </Button>\n                      </>\n                    )}\n                  </nav>\n                </SheetContent>\n              </Sheet>\n            </>\n          )}\n        </div>\n      </div>\n    </header>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1192, "column": 0}, "map": {"version":3,"sources":["file:///Users/puyijun/Downloads/authentication-flow-design%20%281%29/components/ui/card.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Card({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        'bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        '@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn('leading-none font-semibold', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn('text-muted-foreground text-sm', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        'col-start-2 row-span-2 row-start-1 self-start justify-self-end',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn('px-6', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn('flex items-center px-6 [.border-t]:pt-6', className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,EAAE,SAAS,EAAE,GAAG,OAAoC;IAChE,qBACE,8ZAAC;QACC,aAAU;QACV,WAAW,IAAA,+KAAE,EACX,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,8ZAAC;QACC,aAAU;QACV,WAAW,IAAA,+KAAE,EACX,4JACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,UAAU,EAAE,SAAS,EAAE,GAAG,OAAoC;IACrE,qBACE,8ZAAC;QACC,aAAU;QACV,WAAW,IAAA,+KAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,gBAAgB,EAAE,SAAS,EAAE,GAAG,OAAoC;IAC3E,qBACE,8ZAAC;QACC,aAAU;QACV,WAAW,IAAA,+KAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,8ZAAC;QACC,aAAU;QACV,WAAW,IAAA,+KAAE,EACX,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,8ZAAC;QACC,aAAU;QACV,WAAW,IAAA,+KAAE,EAAC,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,8ZAAC;QACC,aAAU;QACV,WAAW,IAAA,+KAAE,EAAC,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf;MARS"}},
    {"offset": {"line": 1312, "column": 0}, "map": {"version":3,"sources":["file:///Users/puyijun/Downloads/authentication-flow-design%20%281%29/lib/supabase-client.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\"\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  // 在构建/运行时给出明确提示，方便排查\n  // 注意：不会阻止应用运行，但 Supabase 相关功能会失败\n  // eslint-disable-next-line no-console\n  console.error(\n    \"[Supabase] ❌ 缺少环境变量！请在 .env.local 中配置：\",\n    \"\\n  NEXT_PUBLIC_SUPABASE_URL=你的Supabase项目URL\",\n    \"\\n  NEXT_PUBLIC_SUPABASE_ANON_KEY=你的Supabase Anon Key\",\n    \"\\n配置后请重启开发服务器（Ctrl+C 然后 pnpm run dev）\"\n  )\n}\n\n// 如果环境变量缺失，使用占位符（会导致请求失败，但不会崩溃）\nexport const supabase = createClient(\n  supabaseUrl || \"https://placeholder.supabase.co\",\n  supabaseAnonKey || \"placeholder_key\",\n  {\n    auth: {\n      persistSession: true,\n      autoRefreshToken: true,\n      detectSessionInUrl: true,\n    },\n  }\n)\n\n\n"],"names":[],"mappings":";;;;AAEoB;AAFpB;;AAEA,MAAM;AACN,MAAM;AAEN;;AAaO,MAAM,WAAW,IAAA,8TAAY,EAClC,eAAe,mCACf,mBAAmB,mBACnB;IACE,MAAM;QACJ,gBAAgB;QAChB,kBAAkB;QAClB,oBAAoB;IACtB;AACF"}},
    {"offset": {"line": 1337, "column": 0}, "map": {"version":3,"sources":["file:///Users/puyijun/Downloads/authentication-flow-design%20%281%29/lib/auth.ts"],"sourcesContent":["import { supabase } from \"./supabase-client\"\n\nexport type AppUser = {\n  id: string\n  email: string\n}\n\n/**\n * 获取当前登录用户\n * 使用 getSession() 而不是 getUser()，避免在没有 session 时抛出错误\n */\nexport async function getCurrentUser(): Promise<AppUser | null> {\n  const {\n    data: { session },\n    error,\n  } = await supabase.auth.getSession()\n\n  if (error) {\n    console.error(\"[auth] getSession error\", error)\n    return null\n  }\n\n  if (!session?.user || !session.user.email) return null\n  return { id: session.user.id, email: session.user.email }\n}\n\n/**\n * 确保 profiles 中存在记录，默认 role = 'fan'\n */\nexport async function ensureProfile() {\n  const user = await getCurrentUser()\n  if (!user) return\n\n  const { data, error } = await supabase\n    .from(\"profiles\")\n    .select(\"id, role, age_verified\")\n    .eq(\"id\", user.id)\n    .maybeSingle()\n\n  if (error) {\n    console.error(\"[auth] ensureProfile select error\", error)\n    return\n  }\n\n  if (!data) {\n    const { error: insertError } = await supabase.from(\"profiles\").insert({\n      id: user.id,\n      email: user.email,\n      display_name: user.email.split(\"@\")[0],\n      role: \"fan\",\n      age_verified: false,\n    })\n    if (insertError) {\n      console.error(\"[auth] ensureProfile insert error\", insertError)\n    }\n  }\n}\n\nexport async function signUpWithEmail(email: string, password: string) {\n  const { data, error } = await supabase.auth.signUp({\n    email,\n    password,\n    options: {\n      emailRedirectTo: typeof window !== \"undefined\" ? `${window.location.origin}/auth/verify` : undefined,\n    },\n  })\n  \n  // 验证证据：打印 session 状态和 user.id\n  if (process.env.NODE_ENV === \"development\") {\n    console.log(\"[auth] signUp response:\", {\n      hasUser: !!data?.user,\n      hasSession: !!data?.session,\n      userId: data?.user?.id || \"none\",\n      error: error?.message || \"none\",\n    })\n  }\n  \n  if (error) {\n    console.error(\"[auth] signUp error:\", error)\n    throw error\n  }\n  \n  // 返回完整的数据，包括 user 和 session（如果有）\n  return data\n}\n\nexport async function signInWithEmail(email: string, password: string) {\n  const { data, error } = await supabase.auth.signInWithPassword({\n    email,\n    password,\n  })\n  \n  // 验证证据：打印 session 状态和 user.id\n  if (process.env.NODE_ENV === \"development\") {\n    console.log(\"[auth] signIn response:\", {\n      hasUser: !!data?.user,\n      hasSession: !!data?.session,\n      userId: data?.user?.id || \"none\",\n      error: error?.message || \"none\",\n    })\n  }\n  \n  if (error) throw error\n  // 登录后一定有 session，返回完整数据\n  return data\n}\n\nexport async function signInWithMagicLink(email: string) {\n  const { data, error } = await supabase.auth.signInWithOtp({\n    email,\n    options: {\n      emailRedirectTo:\n        typeof window !== \"undefined\" ? `${window.location.origin}/auth/verify` : undefined,\n    },\n  })\n  if (error) throw error\n  return data\n}\n\nexport async function signInWithGoogle() {\n  const { data, error } = await supabase.auth.signInWithOAuth({\n    provider: \"google\",\n    options: {\n      redirectTo: typeof window !== \"undefined\" ? `${window.location.origin}/auth/verify` : undefined,\n    },\n  })\n  if (error) throw error\n  return data\n}\n\nexport async function signOut() {\n  const { error } = await supabase.auth.signOut()\n  if (error) throw error\n}\n\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAoEM;AApEN;;AAWO,eAAe;IACpB,MAAM,EACJ,MAAM,EAAE,OAAO,EAAE,EACjB,KAAK,EACN,GAAG,MAAM,kMAAQ,CAAC,IAAI,CAAC,UAAU;IAElC,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO;IACT;IAEA,IAAI,CAAC,SAAS,QAAQ,CAAC,QAAQ,IAAI,CAAC,KAAK,EAAE,OAAO;IAClD,OAAO;QAAE,IAAI,QAAQ,IAAI,CAAC,EAAE;QAAE,OAAO,QAAQ,IAAI,CAAC,KAAK;IAAC;AAC1D;AAKO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM;IAEX,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,kMAAQ,CACnC,IAAI,CAAC,YACL,MAAM,CAAC,0BACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,WAAW;IAEd,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,qCAAqC;QACnD;IACF;IAEA,IAAI,CAAC,MAAM;QACT,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,kMAAQ,CAAC,IAAI,CAAC,YAAY,MAAM,CAAC;YACpE,IAAI,KAAK,EAAE;YACX,OAAO,KAAK,KAAK;YACjB,cAAc,KAAK,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE;YACtC,MAAM;YACN,cAAc;QAChB;QACA,IAAI,aAAa;YACf,QAAQ,KAAK,CAAC,qCAAqC;QACrD;IACF;AACF;AAEO,eAAe,gBAAgB,KAAa,EAAE,QAAgB;IACnE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,kMAAQ,CAAC,IAAI,CAAC,MAAM,CAAC;QACjD;QACA;QACA,SAAS;YACP,iBAAiB,uCAAgC,GAAG,OAAO,QAAQ,CAAC,MAAM,CAAC,YAAY,CAAC,GAAG;QAC7F;IACF;IAEA,8BAA8B;IAC9B,wCAA4C;QAC1C,QAAQ,GAAG,CAAC,2BAA2B;YACrC,SAAS,CAAC,CAAC,MAAM;YACjB,YAAY,CAAC,CAAC,MAAM;YACpB,QAAQ,MAAM,MAAM,MAAM;YAC1B,OAAO,OAAO,WAAW;QAC3B;IACF;IAEA,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,wBAAwB;QACtC,MAAM;IACR;IAEA,iCAAiC;IACjC,OAAO;AACT;AAEO,eAAe,gBAAgB,KAAa,EAAE,QAAgB;IACnE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,kMAAQ,CAAC,IAAI,CAAC,kBAAkB,CAAC;QAC7D;QACA;IACF;IAEA,8BAA8B;IAC9B,wCAA4C;QAC1C,QAAQ,GAAG,CAAC,2BAA2B;YACrC,SAAS,CAAC,CAAC,MAAM;YACjB,YAAY,CAAC,CAAC,MAAM;YACpB,QAAQ,MAAM,MAAM,MAAM;YAC1B,OAAO,OAAO,WAAW;QAC3B;IACF;IAEA,IAAI,OAAO,MAAM;IACjB,wBAAwB;IACxB,OAAO;AACT;AAEO,eAAe,oBAAoB,KAAa;IACrD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,kMAAQ,CAAC,IAAI,CAAC,aAAa,CAAC;QACxD;QACA,SAAS;YACP,iBACE,uCAAgC,GAAG,OAAO,QAAQ,CAAC,MAAM,CAAC,YAAY,CAAC,GAAG;QAC9E;IACF;IACA,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,kMAAQ,CAAC,IAAI,CAAC,eAAe,CAAC;QAC1D,UAAU;QACV,SAAS;YACP,YAAY,uCAAgC,GAAG,OAAO,QAAQ,CAAC,MAAM,CAAC,YAAY,CAAC,GAAG;QACxF;IACF;IACA,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,kMAAQ,CAAC,IAAI,CAAC,OAAO;IAC7C,IAAI,OAAO,MAAM;AACnB"}},
    {"offset": {"line": 1462, "column": 0}, "map": {"version":3,"sources":["file:///Users/puyijun/Downloads/authentication-flow-design%20%281%29/lib/profile.ts"],"sourcesContent":["/**\n * Profile 管理函数\n * 处理 creator onboarding 和 profile 更新\n */\n\nimport { supabase } from \"./supabase-client\"\n\n/**\n * 将用户角色设置为 creator\n * @param userId 用户 ID\n * @returns true 成功，false 失败\n */\nexport async function setRoleCreator(userId: string): Promise<boolean> {\n  try {\n    const { error } = await supabase\n      .from(\"profiles\")\n      .update({ role: \"creator\" })\n      .eq(\"id\", userId)\n\n    if (error) {\n      console.error(\"[profile] setRoleCreator error:\", error)\n      return false\n    }\n\n    return true\n  } catch (err) {\n    console.error(\"[profile] setRoleCreator exception:\", err)\n    return false\n  }\n}\n\n/**\n * 更新 creator profile 信息\n * @param params 更新参数\n * @returns true 成功，false 失败\n */\nexport async function updateCreatorProfile(params: {\n  userId: string\n  display_name?: string\n  bio?: string\n  avatar_url?: string\n}): Promise<boolean> {\n  try {\n    const updateData: {\n      display_name?: string\n      bio?: string\n      avatar_url?: string\n    } = {}\n\n    if (params.display_name !== undefined) {\n      updateData.display_name = params.display_name\n    }\n    if (params.bio !== undefined) {\n      updateData.bio = params.bio\n    }\n    if (params.avatar_url !== undefined) {\n      updateData.avatar_url = params.avatar_url\n    }\n\n    if (Object.keys(updateData).length === 0) {\n      console.warn(\"[profile] updateCreatorProfile: no fields to update\")\n      return true // 没有字段要更新，视为成功\n    }\n\n    const { error } = await supabase\n      .from(\"profiles\")\n      .update(updateData)\n      .eq(\"id\", params.userId)\n\n    if (error) {\n      console.error(\"[profile] updateCreatorProfile error:\", error)\n      return false\n    }\n\n    return true\n  } catch (err) {\n    console.error(\"[profile] updateCreatorProfile exception:\", err)\n    return false\n  }\n}\n\n/**\n * 获取用户 profile（包含 role, display_name, bio, avatar_url）\n * @param userId 用户 ID\n * @returns profile 数据或 null\n */\nexport async function getProfile(userId: string) {\n  try {\n    const { data, error } = await supabase\n      .from(\"profiles\")\n      .select(\"id, role, display_name, bio, avatar_url, email\")\n      .eq(\"id\", userId)\n      .single()\n\n    if (error) {\n      console.error(\"[profile] getProfile error:\", error)\n      return null\n    }\n\n    return data\n  } catch (err) {\n    console.error(\"[profile] getProfile exception:\", err)\n    return null\n  }\n}\n\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;AAED;;AAOO,eAAe,eAAe,MAAc;IACjD,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,kMAAQ,CAC7B,IAAI,CAAC,YACL,MAAM,CAAC;YAAE,MAAM;QAAU,GACzB,EAAE,CAAC,MAAM;QAEZ,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,mCAAmC;YACjD,OAAO;QACT;QAEA,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,uCAAuC;QACrD,OAAO;IACT;AACF;AAOO,eAAe,qBAAqB,MAK1C;IACC,IAAI;QACF,MAAM,aAIF,CAAC;QAEL,IAAI,OAAO,YAAY,KAAK,WAAW;YACrC,WAAW,YAAY,GAAG,OAAO,YAAY;QAC/C;QACA,IAAI,OAAO,GAAG,KAAK,WAAW;YAC5B,WAAW,GAAG,GAAG,OAAO,GAAG;QAC7B;QACA,IAAI,OAAO,UAAU,KAAK,WAAW;YACnC,WAAW,UAAU,GAAG,OAAO,UAAU;QAC3C;QAEA,IAAI,OAAO,IAAI,CAAC,YAAY,MAAM,KAAK,GAAG;YACxC,QAAQ,IAAI,CAAC;YACb,OAAO,KAAK,eAAe;;QAC7B;QAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,kMAAQ,CAC7B,IAAI,CAAC,YACL,MAAM,CAAC,YACP,EAAE,CAAC,MAAM,OAAO,MAAM;QAEzB,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,yCAAyC;YACvD,OAAO;QACT;QAEA,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,6CAA6C;QAC3D,OAAO;IACT;AACF;AAOO,eAAe,WAAW,MAAc;IAC7C,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,kMAAQ,CACnC,IAAI,CAAC,YACL,MAAM,CAAC,kDACP,EAAE,CAAC,MAAM,QACT,MAAM;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,+BAA+B;YAC7C,OAAO;QACT;QAEA,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO;IACT;AACF"}},
    {"offset": {"line": 1538, "column": 0}, "map": {"version":3,"sources":["file:///Users/puyijun/Downloads/authentication-flow-design%20%281%29/lib/posts.ts"],"sourcesContent":["/**\n * Posts 数据访问层\n * Phase 1: Creator 发帖和 Feed\n */\n\nimport { supabase } from \"./supabase-client\"\nimport { getCurrentUser } from \"./auth\"\nimport { getProfile } from \"./profile\"\n\nexport type PostVisibility = 'free' | 'subscribers' | 'ppv'\n\nexport type Post = {\n  id: string\n  creator_id: string\n  title?: string\n  content: string\n  media_url?: string\n  is_locked: boolean // 保留向后兼容\n  visibility: PostVisibility\n  price_cents: number | null\n  created_at: string\n  creator?: {\n    display_name?: string\n    avatar_url?: string\n  }\n}\n\n/**\n * 创建 post（仅 creator 可创建）\n * @param params Post 参数\n * @returns post.id 或 null（失败）\n */\nexport async function createPost(params: {\n  title?: string\n  content: string\n  media_url?: string\n  visibility: PostVisibility\n  price_cents?: number | null\n}): Promise<string | null> {\n  try {\n    // 检查当前用户是否为 creator\n    const user = await getCurrentUser()\n    if (!user) {\n      console.error(\"[posts] createPost: no user\")\n      return null\n    }\n\n    const profile = await getProfile(user.id)\n    if (!profile || profile.role !== \"creator\") {\n      console.error(\"[posts] createPost: user is not a creator\", profile?.role)\n      return null\n    }\n\n    // 验证参数\n    if (params.visibility === 'ppv' && (!params.price_cents || params.price_cents <= 0)) {\n      console.error(\"[posts] createPost: ppv post must have price_cents > 0\")\n      return null\n    }\n\n    // 创建 post\n    const { data, error } = await supabase\n      .from(\"posts\")\n      .insert({\n        creator_id: user.id,\n        title: params.title || null,\n        content: params.content,\n        media_url: params.media_url || null,\n        visibility: params.visibility,\n        price_cents: params.visibility === 'ppv' ? params.price_cents! : null,\n        is_locked: params.visibility !== 'free', // 向后兼容\n      })\n      .select(\"id\")\n      .single()\n\n    if (error) {\n      console.error(\"[posts] createPost error:\", error)\n      return null\n    }\n\n    return data.id\n  } catch (err) {\n    console.error(\"[posts] createPost exception:\", err)\n    return null\n  }\n}\n\n/**\n * 获取某个 creator 的 posts\n * @param creatorId Creator ID\n * @returns Post 数组\n */\nexport async function listCreatorPosts(creatorId: string): Promise<Post[]> {\n  try {\n    const { data, error } = await supabase\n      .from(\"posts\")\n      .select(\"*\")\n      .eq(\"creator_id\", creatorId)\n      .order(\"created_at\", { ascending: false })\n\n    if (error) {\n      console.error(\"[posts] listCreatorPosts error:\", error)\n      return []\n    }\n\n    return (data || []).map((post) => ({\n      id: post.id,\n      creator_id: post.creator_id,\n      title: post.title,\n      content: post.content,\n      media_url: post.media_url,\n      is_locked: post.is_locked || post.visibility !== 'free',\n      visibility: post.visibility || 'free',\n      price_cents: post.price_cents || null,\n      created_at: post.created_at,\n    }))\n  } catch (err) {\n    console.error(\"[posts] listCreatorPosts exception:\", err)\n    return []\n  }\n}\n\n/**\n * 获取 Feed（最近 N 条 posts，包含 creator 信息）\n * @param limit 限制数量，默认 20\n * @returns Post 数组（包含 creator 信息）\n */\nexport async function listFeed(limit: number = 20): Promise<Post[]> {\n  try {\n    // 查询 posts 并 join profiles 获取 creator 信息\n    const { data, error } = await supabase\n      .from(\"posts\")\n      .select(\n        `\n        id,\n        creator_id,\n        title,\n        content,\n        media_url,\n        is_locked,\n        visibility,\n        price_cents,\n        created_at,\n        profiles:creator_id (\n          display_name,\n          avatar_url\n        )\n      `\n      )\n      .order(\"created_at\", { ascending: false })\n      .limit(limit)\n\n    if (error) {\n      console.error(\"[posts] listFeed error:\", error)\n      return []\n    }\n\n    return (data || []).map((item: any) => ({\n      id: item.id,\n      creator_id: item.creator_id,\n      title: item.title,\n      content: item.content,\n      media_url: item.media_url,\n      is_locked: item.is_locked || item.visibility !== 'free',\n      visibility: item.visibility || 'free',\n      price_cents: item.price_cents || null,\n      created_at: item.created_at,\n      creator: {\n        display_name: item.profiles?.display_name,\n        avatar_url: item.profiles?.avatar_url,\n      },\n    }))\n  } catch (err) {\n    console.error(\"[posts] listFeed exception:\", err)\n    return []\n  }\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1669, "column": 0}, "map": {"version":3,"sources":["file:///Users/puyijun/Downloads/authentication-flow-design%20%281%29/lib/paywall.ts"],"sourcesContent":["/**\n * Paywall 数据访问层\n * Phase 2: 付费墙最小闭环\n */\n\nimport { supabase } from \"./supabase-client\"\nimport { getCurrentUser } from \"./auth\"\n\nexport type PaywallState = {\n  hasActiveSubscription: boolean\n  unlockedPostIds: Set<string>\n}\n\n/**\n * 订阅 30 天（创建/更新 subscription）\n * @param creatorId Creator ID\n * @returns true 成功，false 失败\n */\nexport async function subscribe30d(creatorId: string): Promise<boolean> {\n  try {\n    const user = await getCurrentUser()\n    if (!user) {\n      console.error(\"[paywall] subscribe30d: no user\")\n      return false\n    }\n\n    const now = new Date()\n    const endsAt = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000) // +30 days\n\n    // 使用 upsert（ON CONFLICT subscriber_id, creator_id DO UPDATE）\n    const { error } = await supabase\n      .from(\"subscriptions\")\n      .upsert(\n        {\n          subscriber_id: user.id,\n          creator_id: creatorId,\n          status: \"active\",\n          starts_at: now.toISOString(),\n          ends_at: endsAt.toISOString(),\n        },\n        {\n          onConflict: \"subscriber_id,creator_id\",\n        }\n      )\n\n    if (error) {\n      console.error(\"[paywall] subscribe30d error:\", error)\n      return false\n    }\n\n    return true\n  } catch (err) {\n    console.error(\"[paywall] subscribe30d exception:\", err)\n    return false\n  }\n}\n\n/**\n * 取消订阅\n * @param creatorId Creator ID\n * @returns true 成功，false 失败\n */\nexport async function cancelSubscription(creatorId: string): Promise<boolean> {\n  try {\n    const user = await getCurrentUser()\n    if (!user) {\n      console.error(\"[paywall] cancelSubscription: no user\")\n      return false\n    }\n\n    const { error } = await supabase\n      .from(\"subscriptions\")\n      .update({ status: \"canceled\" })\n      .eq(\"subscriber_id\", user.id)\n      .eq(\"creator_id\", creatorId)\n\n    if (error) {\n      console.error(\"[paywall] cancelSubscription error:\", error)\n      return false\n    }\n\n    return true\n  } catch (err) {\n    console.error(\"[paywall] cancelSubscription exception:\", err)\n    return false\n  }\n}\n\n/**\n * 检查是否有 active subscription\n * @param creatorId Creator ID\n * @returns true 有 active subscription，false 没有\n */\nexport async function hasActiveSubscription(creatorId: string): Promise<boolean> {\n  try {\n    const user = await getCurrentUser()\n    if (!user) {\n      return false\n    }\n\n    const { data, error } = await supabase\n      .from(\"subscriptions\")\n      .select(\"id\")\n      .eq(\"subscriber_id\", user.id)\n      .eq(\"creator_id\", creatorId)\n      .eq(\"status\", \"active\")\n      .gt(\"ends_at\", new Date().toISOString())\n      .maybeSingle()\n\n    if (error) {\n      console.error(\"[paywall] hasActiveSubscription error:\", error)\n      return false\n    }\n\n    return !!data\n  } catch (err) {\n    console.error(\"[paywall] hasActiveSubscription exception:\", err)\n    return false\n  }\n}\n\n/**\n * 解锁单个 post（PPV unlock）\n * @param postId Post ID\n * @returns true 成功，false 失败（unique 冲突视为成功）\n */\nexport async function unlockPost(postId: string): Promise<boolean> {\n  try {\n    const user = await getCurrentUser()\n    if (!user) {\n      console.error(\"[paywall] unlockPost: no user\")\n      return false\n    }\n\n    const { error } = await supabase.from(\"post_unlocks\").insert({\n      user_id: user.id,\n      post_id: postId,\n    })\n\n    if (error) {\n      // unique 冲突视为成功（已解锁）\n      if (error.code === \"23505\") {\n        return true\n      }\n      console.error(\"[paywall] unlockPost error:\", error)\n      return false\n    }\n\n    return true\n  } catch (err) {\n    console.error(\"[paywall] unlockPost exception:\", err)\n    return false\n  }\n}\n\n/**\n * 检查是否可以查看 post（creator 本人 OR active subscription OR post_unlock）\n * @param postId Post ID\n * @param creatorId Creator ID（可选，如果提供可以更快判断）\n * @returns true 可以查看，false 不能查看\n */\nexport async function canViewPost(postId: string, creatorId?: string): Promise<boolean> {\n  try {\n    const user = await getCurrentUser()\n    if (!user) {\n      return false\n    }\n\n    // 1. 检查是否是 creator 本人\n    if (creatorId && creatorId === user.id) {\n      return true\n    }\n\n    // 2. 查询 post 信息（包括 is_locked 和 creator_id）\n    const { data: post, error: postError } = await supabase\n      .from(\"posts\")\n      .select(\"id, is_locked, creator_id\")\n      .eq(\"id\", postId)\n      .single()\n\n    if (postError || !post) {\n      console.error(\"[paywall] canViewPost: post not found\", postError)\n      return false\n    }\n\n    // 3. 如果是公开 post，可以直接查看\n    if (!post.is_locked) {\n      return true\n    }\n\n    // 4. 如果是 creator 本人\n    if (post.creator_id === user.id) {\n      return true\n    }\n\n    // 5. 检查是否有 active subscription\n    const hasSub = await hasActiveSubscription(post.creator_id)\n    if (hasSub) {\n      return true\n    }\n\n    // 6. 检查是否已解锁\n    const { data: unlock, error: unlockError } = await supabase\n      .from(\"post_unlocks\")\n      .select(\"id\")\n      .eq(\"user_id\", user.id)\n      .eq(\"post_id\", postId)\n      .maybeSingle()\n\n    if (unlockError) {\n      console.error(\"[paywall] canViewPost: unlock check error\", unlockError)\n      return false\n    }\n\n    return !!unlock\n  } catch (err) {\n    console.error(\"[paywall] canViewPost exception:\", err)\n    return false\n  }\n}\n\n/**\n * 获取当前用户的 paywall 状态（用于批量检查）\n * @param userId 用户 ID\n * @returns PaywallState 或 null（如果查询失败）\n */\nexport async function getMyPaywallState(userId: string): Promise<PaywallState | null> {\n  try {\n    // 1. 查询 active subscriptions\n    const { data: subscriptions, error: subError } = await supabase\n      .from(\"subscriptions\")\n      .select(\"creator_id\")\n      .eq(\"subscriber_id\", userId)\n      .eq(\"status\", \"active\")\n      .gt(\"ends_at\", new Date().toISOString())\n\n    if (subError) {\n      console.error(\"[paywall] getMyPaywallState subscriptions error:\", subError)\n      return null\n    }\n\n    // 2. 查询 unlocked posts\n    const { data: unlocks, error: unlockError } = await supabase\n      .from(\"post_unlocks\")\n      .select(\"post_id\")\n      .eq(\"user_id\", userId)\n\n    if (unlockError) {\n      console.error(\"[paywall] getMyPaywallState post_unlocks error:\", unlockError)\n      return null\n    }\n\n    const unlockedPostIds = new Set<string>(\n      unlocks?.map((u) => u.post_id) || []\n    )\n\n    return {\n      hasActiveSubscription: (subscriptions?.length || 0) > 0,\n      unlockedPostIds,\n    }\n  } catch (err) {\n    console.error(\"[paywall] getMyPaywallState exception:\", err)\n    return null\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1854, "column": 0}, "map": {"version":3,"sources":["file:///Users/puyijun/Downloads/authentication-flow-design%20%281%29/app/home/page.tsx"],"sourcesContent":["\"use client\"\n\nimport { useState, useEffect } from \"react\"\nimport { useRouter } from \"next/navigation\"\nimport { NavHeader } from \"@/components/nav-header\"\nimport { Button } from \"@/components/ui/button\"\nimport { Card } from \"@/components/ui/card\"\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\nimport { ensureProfile, getCurrentUser } from \"@/lib/auth\"\nimport { supabase } from \"@/lib/supabase-client\"\nimport { getProfile, setRoleCreator } from \"@/lib/profile\"\nimport { listFeed, type Post as PostFromDB } from \"@/lib/posts\"\nimport { canViewPost, subscribe30d, hasActiveSubscription } from \"@/lib/paywall\"\nimport { Button } from \"@/components/ui/button\"\nimport { Lock } from \"lucide-react\"\nimport Link from \"next/link\"\n\nexport default function HomePage() {\n  const router = useRouter()\n  const [posts, setPosts] = useState<PostFromDB[]>([])\n  const [feedLoading, setFeedLoading] = useState(true)\n  const [feedError, setFeedError] = useState<string | null>(null)\n  const [isLoading, setIsLoading] = useState(true)\n  const [currentUserId, setCurrentUserId] = useState<string | null>(null)\n  const [userProfile, setUserProfile] = useState<{\n    role: string\n    display_name?: string\n    avatar_url?: string\n  } | null>(null)\n  const [isUpdatingRole, setIsUpdatingRole] = useState(false)\n  const [postViewStates, setPostViewStates] = useState<Map<string, boolean>>(new Map())\n  const [isSubscribing, setIsSubscribing] = useState<string | null>(null) // creatorId -> loading\n\n  const currentUser = {\n    username: userProfile?.display_name || \"user\",\n    role: (userProfile?.role || \"fan\") as \"fan\" | \"creator\",\n    avatar: userProfile?.avatar_url || \"/fan-user-avatar.jpg\",\n  }\n\n  // 加载 feed\n  const loadFeed = async () => {\n    try {\n      setFeedLoading(true)\n      setFeedError(null)\n      const feedPosts = await listFeed(20)\n      setPosts(feedPosts)\n      \n      // 加载每个 post 的可见性状态（在 posts 加载后）\n      if (currentUserId) {\n        const states = new Map<string, boolean>()\n        for (const post of feedPosts) {\n          if (post.is_locked) {\n            const canView = await canViewPost(post.id, post.creator_id)\n            states.set(post.id, canView)\n          } else {\n            states.set(post.id, true) // free posts 总是可见\n          }\n        }\n        setPostViewStates(states)\n      }\n    } catch (err) {\n      console.error(\"[home] loadFeed error\", err)\n      setFeedError(\"加载 feed 失败\")\n    } finally {\n      setFeedLoading(false)\n    }\n  }\n\n  // 处理 Subscribe 按钮点击\n  const handleSubscribe = async (creatorId: string) => {\n    if (!currentUserId || isSubscribing) return\n\n    try {\n      setIsSubscribing(creatorId)\n      const success = await subscribe30d(creatorId)\n      \n      if (success) {\n        // 重新加载 feed（会自动更新可见性状态）\n        await loadFeed()\n      } else {\n        setFeedError(\"订阅失败，请重试\")\n      }\n    } catch (err) {\n      console.error(\"[home] handleSubscribe error\", err)\n      setFeedError(\"订阅失败，请重试\")\n    } finally {\n      setIsSubscribing(null)\n    }\n  }\n\n  // Phase 1: 暂时移除 paywall state 加载\n\n  // 兜底：确保 profile 存在，避免已有 session 但 profile 缺失导致报错\n  useEffect(() => {\n    const checkAuthAndProfile = async () => {\n      try {\n        // 读取 supabase.auth.getSession()，没有 session 就 push /auth\n        const {\n          data: { session },\n          error: sessionError,\n        } = await supabase.auth.getSession()\n\n        if (sessionError || !session) {\n          console.log(\"[home] No session, redirecting to /auth\")\n          router.push(\"/auth\")\n          return\n        }\n\n        // 有 session 则 ensureProfile()，保证 profiles 一定存在\n        console.log(\"[home] Has session, ensuring profile for user:\", session.user.id)\n        await ensureProfile()\n        \n        // 设置 userId\n        setCurrentUserId(session.user.id)\n        \n        // 加载用户 profile（包含 role）\n        const profile = await getProfile(session.user.id)\n        if (profile) {\n          setUserProfile({\n            role: profile.role || \"fan\",\n            display_name: profile.display_name,\n            avatar_url: profile.avatar_url || undefined,\n          })\n        }\n\n        // 加载 feed\n        await loadFeed()\n      } catch (err) {\n        console.error(\"[home] checkAuthAndProfile error\", err)\n        // 出错也重定向到登录页，避免卡死\n        router.push(\"/auth\")\n      } finally {\n        setIsLoading(false)\n      }\n    }\n    checkAuthAndProfile()\n  }, [router])\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-muted-foreground\">Loading...</div>\n      </div>\n    )\n  }\n\n  // Phase 1: 暂时移除 paywall error 处理\n\n  // Phase 1: 暂时移除 paywall 相关功能，只做基础 feed 展示\n\n  // Phase 1: 所有 posts 都是公开的\n  const filteredPosts = posts\n\n  // 处理 Become a Creator 按钮点击\n  const handleBecomeCreator = async () => {\n    if (!currentUserId || isUpdatingRole) return\n\n    try {\n      setIsUpdatingRole(true)\n      const success = await setRoleCreator(currentUserId)\n      \n      if (success) {\n        // 更新本地 state\n        setUserProfile((prev) => (prev ? { ...prev, role: \"creator\" } : { role: \"creator\" }))\n        // 跳转到 onboarding\n        router.push(\"/creator/onboarding\")\n      } else {\n        setFeedError(\"更新角色失败，请重试\")\n      }\n    } catch (err) {\n      console.error(\"[home] handleBecomeCreator error\", err)\n      setFeedError(\"更新角色失败，请重试\")\n    } finally {\n      setIsUpdatingRole(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <NavHeader user={currentUser} notificationCount={3} />\n\n      {/* Become a Creator / Creator Dashboard Button */}\n      <div className=\"container max-w-2xl mx-auto px-4 pt-6\">\n        {userProfile?.role === \"fan\" ? (\n          <Button\n            onClick={handleBecomeCreator}\n            disabled={isUpdatingRole}\n            className=\"w-full mb-6\"\n            size=\"lg\"\n          >\n            {isUpdatingRole ? \"处理中...\" : \"Become a Creator\"}\n          </Button>\n        ) : userProfile?.role === \"creator\" ? (\n          <Button\n            onClick={() => router.push(\"/creator/onboarding\")}\n            variant=\"outline\"\n            className=\"w-full mb-6\"\n            size=\"lg\"\n          >\n            Creator Dashboard\n          </Button>\n        ) : null}\n      </div>\n\n      <main className=\"container max-w-2xl mx-auto px-4 py-6\">\n        {/* Phase 1: 暂时移除 filter 按钮 */}\n\n        {/* Posts Feed */}\n        {feedLoading ? (\n          <div className=\"text-center py-12 text-muted-foreground\">Loading feed...</div>\n        ) : feedError ? (\n          <div className=\"bg-destructive/10 border border-destructive/20 rounded-lg p-4\">\n            <p className=\"text-destructive font-medium\">错误</p>\n            <p className=\"text-sm text-muted-foreground mt-1\">{feedError}</p>\n            <Button className=\"mt-4\" onClick={loadFeed}>重试</Button>\n          </div>\n        ) : filteredPosts.length === 0 ? (\n          <div className=\"text-center py-12 text-muted-foreground\">No posts yet. Be the first to create one!</div>\n        ) : (\n          <div className=\"space-y-6\">\n            {filteredPosts.map((post) => (\n              <Card key={post.id} className=\"overflow-hidden\">\n                {/* Creator Header */}\n                <div className=\"p-4 flex items-center justify-between\">\n                  <Link href={`/creator/${post.creator_id}`} className=\"flex items-center gap-3 flex-1\">\n                    <Avatar className=\"w-10 h-10\">\n                      <AvatarImage src={post.creator?.avatar_url || \"/placeholder.svg\"} />\n                      <AvatarFallback>\n                        {post.creator?.display_name?.[0]?.toUpperCase() || \"C\"}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"font-semibold text-foreground\">\n                          {post.creator?.display_name || \"Creator\"}\n                        </span>\n                      </div>\n                      <span className=\"text-sm text-muted-foreground\">{formatDate(post.created_at)}</span>\n                    </div>\n                  </Link>\n                </div>\n\n                {/* Post Content */}\n                <div className=\"px-4 pb-3\">\n                  {post.title && (\n                    <h3 className=\"font-semibold text-foreground mb-2\">{post.title}</h3>\n                  )}\n                  {post.is_locked && !postViewStates.get(post.id) ? (\n                    <div className=\"bg-muted/50 rounded-lg p-4 text-center\">\n                      <Lock className=\"w-8 h-8 mx-auto mb-2 text-muted-foreground\" />\n                      <p className=\"text-muted-foreground mb-3\">This content is locked</p>\n                      <Button\n                        size=\"sm\"\n                        onClick={() => handleSubscribe(post.creator_id)}\n                        disabled={isSubscribing === post.creator_id}\n                      >\n                        {isSubscribing === post.creator_id ? \"处理中...\" : \"Subscribe to unlock\"}\n                      </Button>\n                    </div>\n                  ) : (\n                    <p className=\"text-foreground whitespace-pre-wrap\">{post.content}</p>\n                  )}\n                </div>\n\n                {/* Media */}\n                {post.media_url && (\n                  <div className=\"relative bg-muted aspect-video\">\n                    {post.is_locked && !postViewStates.get(post.id) ? (\n                      <div className=\"absolute inset-0 bg-black/60 flex items-center justify-center\">\n                        <div className=\"text-center text-white\">\n                          <Lock className=\"w-12 h-12 mx-auto mb-3\" />\n                          <p className=\"mb-3\">Locked Content</p>\n                          <Button\n                            size=\"sm\"\n                            onClick={() => handleSubscribe(post.creator_id)}\n                            disabled={isSubscribing === post.creator_id}\n                          >\n                            {isSubscribing === post.creator_id ? \"处理中...\" : \"Subscribe to unlock\"}\n                          </Button>\n                        </div>\n                      </div>\n                    ) : (\n                      <img\n                        src={post.media_url}\n                        alt=\"Post media\"\n                        className=\"w-full h-full object-cover\"\n                        onError={(e) => {\n                          e.currentTarget.style.display = \"none\"\n                        }}\n                      />\n                    )}\n                  </div>\n                )}\n              </Card>\n            ))}\n          </div>\n        )}\n      </main>\n\n      {/* Phase 1: 暂时移除 paywall modal */}\n    </div>\n  )\n}\n\nfunction formatDate(dateString: string) {\n  const date = new Date(dateString)\n  const now = new Date()\n  const diff = now.getTime() - date.getTime()\n  const hours = Math.floor(diff / (1000 * 60 * 60))\n\n  if (hours < 24) return `${hours}h ago`\n  const days = Math.floor(hours / 24)\n  return `${days}d ago`\n}\n"],"names":[],"mappings":"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"}}]
}